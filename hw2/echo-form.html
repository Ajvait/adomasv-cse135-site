<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Echo Test Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    select, input {
      margin-top: 4px;
    }
  </style>
</head>
<body>

<h1>Echo Test Form</h1>

<p>
This form sends requests to the <strong>echo</strong> programs written in
<strong>PHP, Python, and Go</strong>.
</p>

<p>
<strong>Without JavaScript:</strong>  
The form submits using <code>GET</code> to the PHP echo program.
</p>

<p>
<strong>With JavaScript enabled:</strong>  
You may select the language, HTTP method, and encoding.
</p>

<hr>

<form id="echoForm" method="GET" action="/hw2/phpcode/echo-php.php">

  <label>
    Language:
    <select id="language">
      <option value="php">PHP</option>
      <option value="python">Python</option>
      <option value="go">Go</option>
    </select>
  </label>

  <label>
    HTTP Method:
    <select id="method">
      <option value="GET">GET</option>
      <option value="POST">POST</option>
      <option value="PUT">PUT</option>
      <option value="DELETE">DELETE</option>
    </select>
  </label>

  <label>
    Encoding:
    <select id="encoding">
      <option value="application/x-www-form-urlencoded">
        application/x-www-form-urlencoded
      </option>
      <option value="application/json">
        application/json
      </option>
    </select>
  </label>

  <label>
    Name:
    <input type="text" name="name" value="Adomas">
  </label>

  <label>
    Course:
    <input type="text" name="course" value="CSE135">
  </label>

  <br>
  <button type="submit">Send Request</button>

</form>

<noscript>
  <p><strong>JavaScript is disabled.</strong></p>
  <p>
    This form will submit using <code>GET</code> to
    <code>/hw2/phpcode/echo-php.php</code>.
  </p>
</noscript>

<script>
(function () {
  const form = document.getElementById("echoForm");
  const language = document.getElementById("language");
  const method = document.getElementById("method");
  const encoding = document.getElementById("encoding");

  form.addEventListener("submit", function (e) {
    const lang = language.value;
    const httpMethod = method.value;
    const contentType = encoding.value;

    if (lang === "php") {
      form.action = "/hw2/phpcode/echo-php.php";
    } else if (lang === "python") {
      form.action = "/cgi-bin/echo-python";
    } else if (lang === "go") {
      form.action = "/cgi-bin/echo-go";
    }

    if (httpMethod === "GET" && contentType !== "application/json") {
      form.method = "GET";
      return;
    }

    e.preventDefault();

    const data = {
      name: form.name.value,
      course: form.course.value
    };

    fetch(form.action, {
      method: httpMethod,
      headers: {
        "Content-Type": contentType
      },
      body: contentType === "application/json"
        ? JSON.stringify(data)
        : new URLSearchParams(data)
    })
    .then(res => res.text())
    .then(text => {
      document.body.innerHTML = text;
    })
    .catch(err => {
      document.body.innerHTML = "<pre>Error: " + err + "</pre>";
    });
  });
})();
</script>

</body>
</html>
